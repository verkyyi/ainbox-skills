{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "Validation schema for ainbox-skills agent folders. Used by CI to catch errors before merge.",

  "definitions": {
    "bilingualString": {
      "type": "object",
      "properties": {
        "en": { "type": "string", "minLength": 1 },
        "zh": { "type": "string", "minLength": 1 }
      },
      "required": ["en", "zh"],
      "additionalProperties": false
    },

    "utilityTemplate": {
      "type": "object",
      "properties": {
        "subject": { "$ref": "#/definitions/bilingualString" },
        "body":    { "$ref": "#/definitions/bilingualString" }
      },
      "required": ["subject", "body"]
    },

    "templatesJson": {
      "type": "object",
      "properties": {
        "result":    { "$ref": "#/definitions/bilingualString" },
        "agent":     { "$ref": "#/definitions/bilingualString" },
        "guidance":  { "$ref": "#/definitions/utilityTemplate" },
        "error":     { "$ref": "#/definitions/utilityTemplate" },
        "rateLimit": { "$ref": "#/definitions/utilityTemplate" }
      },
      "additionalProperties": { "$ref": "#/definitions/bilingualString" }
    },

    "tipsJson": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/definitions/bilingualString" }
    },

    "skillFrontmatter": {
      "type": "object",
      "properties": {
        "name":        { "type": "string", "minLength": 1 },
        "description": { "type": "string", "minLength": 1 },
        "metadata": {
          "type": "object",
          "properties": {
            "author":  { "type": "string", "minLength": 1 },
            "version": { "type": "string", "minLength": 1 }
          },
          "required": ["author", "version"]
        },
        "agent": {
          "type": "object",
          "properties": {
            "address":     { "type": "string", "format": "email" },
            "displayName": { "type": "string", "minLength": 1 },
            "tagline":     { "type": "string", "minLength": 1 },
            "modes":       { "type": "object", "minProperties": 1 },
            "capabilities": {
              "type": "array",
              "minItems": 1,
              "items": { "type": "string" }
            }
          },
          "required": ["address", "displayName", "tagline", "modes", "capabilities"]
        },
        "config": {
          "type": "object",
          "properties": {
            "openaiModel":          { "type": "string" },
            "maxCompletionTokens":  { "type": "integer", "minimum": 1 },
            "temperature":          { "type": ["number", "null"] },
            "maxBodyChars":         { "type": "integer", "minimum": 1 },
            "dailyLimit":           { "type": "integer", "minimum": 1 },
            "fromEmail":            { "type": "string" },
            "fromName":             { "type": "string" },
            "feedbackEmail":        { "type": "string" },
            "fallbackForwardTo":    { "type": "string" },
            "autoReplyGuidance":    { "type": "boolean" },
            "allowedSenders":       { "type": "array", "items": { "type": "string" } },
            "blockedSenders":       { "type": "array", "items": { "type": "string" } },
            "senderLimitOverrides": { "type": "object" },
            "dryRun":               { "type": "boolean" }
          },
          "required": [
            "openaiModel",
            "maxCompletionTokens",
            "maxBodyChars",
            "dailyLimit",
            "fromEmail",
            "fromName",
            "feedbackEmail"
          ]
        },
        "variables": {
          "type": "object",
          "properties": {
            "prompt":    { "type": "array", "items": { "type": "string" } },
            "templates": { "type": "array", "items": { "type": "string" } },
            "tips":      { "type": "array", "items": { "type": "string" } }
          }
        }
      },
      "required": ["name", "description", "metadata", "agent", "config"]
    }
  }
}
